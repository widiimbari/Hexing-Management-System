generator client {
  provider = "prisma-client-js"
  output   = "../generated/asset-client-v10"
}

datasource db {
  provider = "postgresql"
  url      = env("ASSET_DATABASE_URL")
}

model areas {
  id         BigInt    @id @default(autoincrement())
  name       String    @unique @db.VarChar(255)
  created_at DateTime? @db.Timestamp(0)
  updated_at DateTime? @db.Timestamp(0)
  locations  locations[]
  assets     assets[]
}

model asset_transactions {
  id                 BigInt    @id @default(autoincrement())
  asset_id           BigInt   
  transaction_type   String    @db.VarChar(50) // PURCHASE, CONDITION_CHANGE, RELOCATION, ASSIGNMENT
  previous_holder_id BigInt?  
  new_holder_id      BigInt?  
  previous_location  String?   @db.VarChar(255)
  new_location       String?   @db.VarChar(255)
  previous_condition String?   @db.VarChar(50)
  new_condition      String?   @db.VarChar(50)
  remarks            String?   @db.Text
  attachment_url     String?   @db.VarChar(255)
  transaction_date   DateTime  @default(now()) @db.Timestamp(0)
  created_by         BigInt?  
  creator_name       String?   @db.VarChar(255)
  created_at         DateTime? @db.Timestamp(0)
  updated_at         DateTime? @db.Timestamp(0)
  
  asset              assets    @relation(fields: [asset_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "asset_transactions_asset_id_foreign")
  // creator            users?    @relation("TransactionCreator", fields: [created_by], references: [id], onDelete: SetNull, onUpdate: Restrict, map: "asset_transactions_created_by_foreign")
  previous_holder    employees? @relation("TransactionPreviousHolder", fields: [previous_holder_id], references: [id], onDelete: SetNull, onUpdate: Restrict, map: "asset_transactions_previous_holder_id_foreign")
  new_holder         employees? @relation("TransactionNewHolder", fields: [new_holder_id], references: [id], onDelete: SetNull, onUpdate: Restrict, map: "asset_transactions_new_holder_id_foreign")

  @@index([asset_id])
  @@index([created_by])
  @@index([previous_holder_id])
  @@index([new_holder_id])
}

model assets {
  id             BigInt   @id @default(autoincrement())
  type_id        BigInt? 
  serial_number  String   @unique @db.VarChar(255)
  sap_id         String?  @db.VarChar(255)
  purchase_date  DateTime? @db.Date
  created_at     DateTime? @db.Timestamp(0)
  updated_at     DateTime? @db.Timestamp(0)
  category_id    BigInt? 
  brand_id       BigInt? 
  area_id        BigInt? 
  location_id    BigInt? 
  employee_id    BigInt? 
  supplier_id    BigInt? 
  image_id       BigInt?  @unique
  
  asset_type     asset_types? @relation(fields: [type_id], references: [id], onDelete: SetNull, onUpdate: Restrict, map: "assets_type_id_foreign")
  category       categories? @relation(fields: [category_id], references: [id], onDelete: SetNull, onUpdate: Restrict, map: "assets_category_id_foreign")
  brand          brands?     @relation(fields: [brand_id], references: [id], onDelete: SetNull, onUpdate: Restrict, map: "assets_brand_id_foreign")
  area           areas?      @relation(fields: [area_id], references: [id], onDelete: SetNull, onUpdate: Restrict, map: "assets_area_id_foreign")
  location       locations?  @relation(fields: [location_id], references: [id], onDelete: SetNull, onUpdate: Restrict, map: "assets_location_id_foreign")
  employee       employees?  @relation("AssetEmployee", fields: [employee_id], references: [id], onDelete: SetNull, onUpdate: Restrict, map: "assets_employee_id_foreign")
  supplier_rec   suppliers?  @relation("AssetSupplier", fields: [supplier_id], references: [id], onDelete: SetNull, onUpdate: Restrict, map: "assets_supplier_id_foreign")
  main_image     asset_images? @relation("AssetMainImage", fields: [image_id], references: [id], onDelete: SetNull, onUpdate: Restrict, map: "assets_image_id_foreign")
  condition      AssetCondition @default(GOOD)
  transactions   asset_transactions[]
  asset_images   asset_images[] @relation("AssetImages")

  @@index([type_id])
  @@index([category_id])
  @@index([brand_id])
  @@index([area_id])
  @@index([location_id])
  @@index([employee_id])
  @@index([supplier_id])
  @@index([image_id])
}

enum AssetCondition {
  GOOD
  SLIGHTLY_DAMAGED
  DAMAGED
  BROKEN
  DISPOSED
  MAINTENANCE
  LOST
}

model activity_log {
  id          BigInt   @id @default(autoincrement())
  action      String   @db.VarChar(50) // CREATE, UPDATE, DELETE, IMPORT, EXPORT
  entity_type String   @db.VarChar(50) // Asset, Category, etc.
  entity_id   String   @db.VarChar(255) // ID of the entity
  details     String?  @db.Text // Description or JSON of changes
  user_id     String?  @db.VarChar(255) // User who performed the action
  user_name   String?  @db.VarChar(255)
  ip_address  String?  @db.VarChar(45)
  created_at  DateTime @default(now()) @db.Timestamp(0)

  @@index([entity_type, entity_id])
  @@index([user_id])
}

model asset_types {
  id         BigInt    @id @default(autoincrement())
  name       String    @unique @db.VarChar(255)
  created_at DateTime? @db.Timestamp(0)
  updated_at DateTime? @db.Timestamp(0)
  assets     assets[]
}

model asset_images {
  id         BigInt   @id @default(autoincrement())
  asset_id   BigInt  
  name       String   @db.VarChar(255)
  url        String?  @db.VarChar(255)
  created_at DateTime @default(now()) @db.Timestamp(0)
  
  asset      assets   @relation("AssetImages", fields: [asset_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "asset_images_asset_id_foreign")
  main_for   assets?  @relation("AssetMainImage")

  @@index([asset_id])
}

model brands {
  id         BigInt    @id @default(autoincrement())
  name       String    @unique @db.VarChar(255)
  created_at DateTime? @db.Timestamp(0)
  updated_at DateTime? @db.Timestamp(0)
  assets     assets[]
}

model categories {
  id         BigInt    @id @default(autoincrement())
  name       String    @unique @db.VarChar(255)
  created_at DateTime? @db.Timestamp(0)
  updated_at DateTime? @db.Timestamp(0)
  assets     assets[]
}

model departments {
  id         BigInt    @id @default(autoincrement())
  name       String    @db.VarChar(255)
  created_at DateTime? @db.Timestamp(0)
  updated_at DateTime? @db.Timestamp(0)
  employees  employees[]
}

model employees {
  id            BigInt    @id @default(autoincrement())
  nik           String    @unique @db.VarChar(255)
  nama          String    @db.VarChar(255)
  gender        String    @db.VarChar(1) // 'L' or 'P'
  created_at    DateTime? @default(now()) @db.Timestamp(0)
  updated_at    DateTime? @default(now()) @db.Timestamp(0)
  department_id BigInt?  
  
  department    departments?  @relation(fields: [department_id], references: [id], onDelete: SetNull, onUpdate: Restrict, map: "employees_department_id_foreign")
  
  previous_trans asset_transactions[] @relation("TransactionPreviousHolder")
  new_trans      asset_transactions[] @relation("TransactionNewHolder")
  assets         assets[]             @relation("AssetEmployee")
  
  @@index([department_id])
}

model locations {
  id         BigInt    @id @default(autoincrement())
  name       String    @db.VarChar(255)
  area_id    BigInt   
  created_at DateTime? @db.Timestamp(0)
  updated_at DateTime? @db.Timestamp(0)
  
  area       areas   @relation(fields: [area_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "locations_area_id_foreign")
  assets     assets[]

  @@index([area_id])
}

model suppliers {
  id             BigInt    @id @default(autoincrement())
  name           String    @db.VarChar(255)
  contact_person String?   @db.VarChar(255)
  phone          String?   @db.VarChar(255)
  email          String?   @db.VarChar(255)
  address        String?   @db.Text
  created_at     DateTime? @db.Timestamp(0)
  updated_at     DateTime? @db.Timestamp(0)
  
  assets         assets[]  @relation("AssetSupplier")
}

model users {
  id                BigInt    @id @default(autoincrement())
  name              String    @db.VarChar(255)
  email             String    @unique @db.VarChar(255)
  email_verified_at DateTime? @db.Timestamp(0)
  password          String    @db.VarChar(255)
  remember_token    String?   @db.VarChar(100)
  created_at        DateTime? @db.Timestamp(0)
  updated_at        DateTime? @db.Timestamp(0)

  // transactions      asset_transactions[] @relation("TransactionCreator")
}
